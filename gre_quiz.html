<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>GRE ë‹¨ì–´ í€´ì¦ˆ (ê°ê´€ì‹)</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 720px;
      margin: 30px auto;
      padding: 0 16px 40px;
      line-height: 1.6;
      background: #f9fafb;
    }
    h1 {
      font-size: 24px;
      margin-bottom: 4px;
    }
    .card {
      background: white;
      border-radius: 16px;
      padding: 18px 20px;
      margin-top: 16px;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.08);
      border: 1px solid #e5e7eb;
    }
    textarea {
      width: 100%;
      height: 140px;
      box-sizing: border-box;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      resize: vertical;
      font-family: inherit;
      font-size: 14px;
    }
    label {
      font-weight: 600;
      font-size: 14px;
    }
    input[type="number"] {
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      font-size: 14px;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
      background: #111827;
      color: white;
      transition: transform 0.05s ease, box-shadow 0.05s ease, opacity 0.2s ease;
      white-space: nowrap;
    }
    button.secondary {
      background: #e5e7eb;
      color: #111827;
    }
    button:disabled {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
    }
    button:not(:disabled):hover {
      transform: translateY(-1px);
      box-shadow: 0 3px 8px rgba(15, 23, 42, 0.25);
    }
    .row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      margin-top: 8px;
    }
    .row > * {
      flex: 1;
      min-width: 0;
    }
    .badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      background: #eff6ff;
      color: #1d4ed8;
    }
    .muted {
      font-size: 12px;
      color: #6b7280;
    }
    .question-word {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 6px;
    }
    .feedback {
      margin-top: 10px;
      font-size: 14px;
      font-weight: 500;
    }
    .feedback.correct {
      color: #16a34a;
    }
    .feedback.incorrect {
      color: #dc2626;
    }
    .score {
      font-size: 14px;
      color: #4b5563;
    }
    .choice-btn {
      width: 100%;
      text-align: left;
      border-radius: 12px;
      padding: 10px 12px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      color: #111827;
      margin-top: 8px;
      font-size: 14px;
      white-space: normal;
    }
    .choice-btn:hover:not(.disabled) {
      background: #eef2ff;
      box-shadow: 0 2px 6px rgba(79, 70, 229, 0.2);
      transform: translateY(-1px);
    }
    .choice-btn.disabled {
      cursor: default;
      opacity: 0.9;
      box-shadow: none;
      transform: none;
    }
    .choice-btn.correct {
      background: #ecfdf3;
      border-color: #22c55e;
      color: #166534;
    }
    .choice-btn.wrong {
      background: #fef2f2;
      border-color: #ef4444;
      color: #b91c1c;
    }
    .wrong-list {
      margin-top: 10px;
      font-size: 13px;
      color: #374151;
      max-height: 260px;
      overflow-y: auto;
      border-top: 1px solid #e5e7eb;
      padding-top: 8px;
    }
    .wrong-item {
      margin-bottom: 6px;
    }
    .wrong-item span.word {
      font-weight: 600;
    }
    .wrong-item span.correct {
      color: #16a34a;
    }
    .wrong-item span.selected {
      color: #dc2626;
    }
  </style>
</head>
<body>
  <h1>ğŸ“š GRE ë‹¨ì–´ í€´ì¦ˆ (ê°ê´€ì‹)</h1>
  <div class="muted">ì—‘ì…€ì—ì„œ ë‹¨ì–´/ëœ»ì„ ë³µì‚¬í•´ ë¶™ì—¬ë„£ê³ , 4ì§€ì„ ë‹¤ ê°ê´€ì‹ + ì˜¤ë‹µë…¸íŠ¸ê¹Œì§€ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ë³´ì„¸ìš”.</div>

  <!-- ë°ì´í„° ì…ë ¥ ì¹´ë“œ -->
  <div class="card">
    <label for="dataInput">1ï¸âƒ£ ì—‘ì…€ì—ì„œ ë‹¨ì–´ì™€ ëœ»ì„ ë³µì‚¬í•´ì„œ ì—¬ê¸°ì— ë¶™ì—¬ë„£ê¸° (Aì—´=ë‹¨ì–´, Bì—´=ëœ»)</label>
    <textarea id="dataInput" placeholder="ì˜ˆì‹œ)
ascetic    ê¸ˆìš•ì ì¸
assuage    ì™„í™”í•˜ë‹¤
audacious  ëŒ€ë‹´í•œ"></textarea>

    <div class="row" style="margin-top: 10px;">
      <button id="loadBtn">ë‹¨ì–´ ë¶ˆëŸ¬ì˜¤ê¸°</button>
      <div class="muted" id="wordCountInfo">ì•„ì§ ë‹¨ì–´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ì•Šì•˜ì–´ìš”.</div>
    </div>

    <div class="row" style="margin-top: 16px;">
      <div>
        <label for="questionCount">2ï¸âƒ£ í•œ ì„¸íŠ¸ì— í’€ ë¬¸ì œ ê°œìˆ˜</label>
        <input type="number" id="questionCount" min="1" value="30" />
      </div>
      <div style="flex: 0 0 auto; align-self: flex-end;">
        <button id="startBtn">ğŸ¯ í€´ì¦ˆ ì‹œì‘</button>
      </div>
    </div>
  </div>

  <!-- í€´ì¦ˆ ì¹´ë“œ -->
  <div class="card" id="quizCard" style="display: none; margin-top: 20px;">
    <div class="row" style="margin-bottom: 6px;">
      <div class="badge" id="progressBadge">ë¬¸ì œ 0 / 0</div>
      <div class="score" id="scoreInfo" style="text-align: right;"></div>
    </div>

    <div class="question-word" id="questionWord">ë‹¨ì–´</div>
    <div class="muted" style="margin-bottom: 6px;">ëœ»ì„ ê³ ë¥´ì„¸ìš” (4ì§€ì„ ë‹¤)</div>

    <div id="optionsContainer"></div>

    <div class="feedback" id="feedbackArea"></div>

    <div class="row" style="margin-top: 12px;">
      <button id="nextBtn" class="secondary" disabled>ë‹¤ìŒ ë¬¸ì œ</button>
    </div>
  </div>

  <!-- ê²°ê³¼ + ì˜¤ë‹µë…¸íŠ¸ ì¹´ë“œ -->
  <div class="card" id="resultCard" style="display: none; margin-top: 20px;">
    <h2>ğŸ‰ ì„¸íŠ¸ ì¢…ë£Œ!</h2>
    <p id="resultText"></p>

    <div id="wrongNoteContainer" style="margin-top: 12px; display: none;">
      <div class="row" style="align-items: center; margin-bottom: 4px;">
        <div style="font-weight: 600; font-size: 14px;">ğŸ“ ì˜¤ë‹µë…¸íŠ¸</div>
        <div style="flex: 0 0 auto; text-align: right;">
          <button id="copyWrongBtn" class="secondary">ì˜¤ë‹µë…¸íŠ¸ ë³µì‚¬í•˜ê¸°</button>
        </div>
      </div>
      <div class="wrong-list" id="wrongList"></div>
    </div>

    <div class="row" style="margin-top: 14px;">
      <button id="restartBtn">ğŸ” ë‹¤ì‹œ í’€ê¸°</button>
    </div>
  </div>

  <script>
    const NUM_CHOICES = 4; // ë³´ê¸° ê°œìˆ˜ (4ì§€ì„ ë‹¤)

    let allWords = [];   // {word, meaning}
    let quizList = [];   // ì´ë²ˆ ì„¸íŠ¸ ë¬¸ì œë“¤
    let currentIndex = 0;
    let score = 0;
    let total = 0;
    let awaitingAnswer = true;
    let wrongAnswers = []; // {word, correct, selected}

    const dataInput = document.getElementById("dataInput");
    const loadBtn = document.getElementById("loadBtn");
    const wordCountInfo = document.getElementById("wordCountInfo");
    const questionCountInput = document.getElementById("questionCount");
    const startBtn = document.getElementById("startBtn");

    const quizCard = document.getElementById("quizCard");
    const questionWord = document.getElementById("questionWord");
    const optionsContainer = document.getElementById("optionsContainer");
    const feedbackArea = document.getElementById("feedbackArea");
    const nextBtn = document.getElementById("nextBtn");
    const progressBadge = document.getElementById("progressBadge");
    const scoreInfo = document.getElementById("scoreInfo");

    const resultCard = document.getElementById("resultCard");
    const resultText = document.getElementById("resultText");
    const wrongNoteContainer = document.getElementById("wrongNoteContainer");
    const wrongList = document.getElementById("wrongList");
    const copyWrongBtn = document.getElementById("copyWrongBtn");
    const restartBtn = document.getElementById("restartBtn");

    function normalize(str) {
      return String(str).toLowerCase().replace(/\s+/g, "");
    }

    function parseData(text) {
      const lines = text.split("\n").map(l => l.trim()).filter(l => l.length > 0);
      const items = [];

      for (const line of lines) {
        let parts = line.split(/\t+/);
        if (parts.length < 2) {
          parts = line.split(/ {2,}/);
        }
        if (parts.length < 2) continue;
        const word = parts[0].trim();
        const meaning = parts.slice(1).join(" ").trim();
        if (!word || !meaning) continue;
        items.push({ word, meaning });
      }
      return items;
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    loadBtn.addEventListener("click", () => {
      const text = dataInput.value;
      const items = parseData(text);
      if (items.length === 0) {
        wordCountInfo.textContent = "âš ï¸ ì¸ì‹ëœ ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤. ì—‘ì…€ì—ì„œ ë‹¤ì‹œ ë³µì‚¬í•´ ë¶™ì—¬ë„£ì–´ ì£¼ì„¸ìš”.";
        return;
      }
      allWords = items;
      wordCountInfo.textContent = `âœ… ${allWords.length}ê°œì˜ ë‹¨ì–´ë¥¼ ë¶ˆëŸ¬ì™”ì–´ìš”.`;
      if (allWords.length < Number(questionCountInput.value)) {
        questionCountInput.value = allWords.length;
      }
    });

    function startQuiz() {
      if (allWords.length === 0) {
        alert("ë¨¼ì € ìœ„ì— ë‹¨ì–´ë¥¼ ë¶™ì—¬ë„£ê³  'ë‹¨ì–´ ë¶ˆëŸ¬ì˜¤ê¸°'ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.");
        return;
      }
      let n = Number(questionCountInput.value) || 30;
      if (n > allWords.length) n = allWords.length;

      total = n;
      score = 0;
      currentIndex = 0;
      awaitingAnswer = true;
      wrongAnswers = [];

      quizList = shuffle([...allWords]).slice(0, n);

      resultCard.style.display = "none";
      quizCard.style.display = "block";

      showCurrentQuestion();
    }

    function createOptions(correctItem) {
      const meanings = [correctItem.meaning];
      const others = shuffle(allWords.filter(w => w.meaning !== correctItem.meaning));

      for (const item of others) {
        if (meanings.length >= NUM_CHOICES) break;
        meanings.push(item.meaning);
      }

      const unique = Array.from(new Set(meanings));
      return shuffle(unique).slice(0, NUM_CHOICES);
    }

    function showCurrentQuestion() {
      if (currentIndex >= total) {
        endQuiz();
        return;
      }

      const item = quizList[currentIndex];
      questionWord.textContent = item.word;
      feedbackArea.textContent = "";
      feedbackArea.className = "feedback";

      progressBadge.textContent = `ë¬¸ì œ ${currentIndex + 1} / ${total}`;
      scoreInfo.textContent = `í˜„ì¬ ì ìˆ˜: ${score} / ${total}`;

      const options = createOptions(item);
      optionsContainer.innerHTML = "";
      awaitingAnswer = true;
      nextBtn.disabled = true;

      options.forEach(optionText => {
        const btn = document.createElement("button");
        btn.className = "choice-btn";
        btn.textContent = optionText;
        btn.onclick = () => handleChoiceClick(btn, optionText, item);
        optionsContainer.appendChild(btn);
      });
    }

    function handleChoiceClick(clickedBtn, selectedMeaning, item) {
      if (!awaitingAnswer) return;
      awaitingAnswer = false;

      const normalizedSelected = normalize(selectedMeaning);
      const normalizedCorrect = normalize(item.meaning);

      const allButtons = optionsContainer.querySelectorAll(".choice-btn");
      allButtons.forEach(btn => {
        btn.classList.add("disabled");
        const btnText = btn.textContent;
        const isCorrectBtn = normalize(btnText) === normalizedCorrect;
        if (isCorrectBtn) {
          btn.classList.add("correct");
        }
      });

      if (normalizedSelected === normalizedCorrect) {
        clickedBtn.classList.add("correct");
        feedbackArea.textContent = "âœ… ì •ë‹µ!";
        feedbackArea.className = "feedback correct";
        score += 1;
      } else {
        clickedBtn.classList.add("wrong");
        feedbackArea.textContent = `âŒ ì˜¤ë‹µ! ì •ë‹µ: ${item.meaning}`;
        feedbackArea.className = "feedback incorrect";

        wrongAnswers.push({
          word: item.word,
          correct: item.meaning,
          selected: selectedMeaning
        });
      }

      scoreInfo.textContent = `í˜„ì¬ ì ìˆ˜: ${score} / ${total}`;
      nextBtn.disabled = false;
    }

    function nextQuestion() {
      if (awaitingAnswer) return;
      currentIndex += 1;
      showCurrentQuestion();
    }

    function buildWrongNoteText() {
      if (wrongAnswers.length === 0) return "";
      const lines = wrongAnswers.map((w, idx) =>
        `${idx + 1}. ${w.word} - ì •ë‹µ: ${w.correct} / ë‚´ ë‹µ: ${w.selected}`
      );
      return lines.join("\n");
    }

    function renderWrongList() {
      if (wrongAnswers.length === 0) {
        wrongNoteContainer.style.display = "none";
        wrongList.innerHTML = "";
        return;
      }
      wrongNoteContainer.style.display = "block";
      wrongList.innerHTML = "";

      wrongAnswers.forEach((w, idx) => {
        const div = document.createElement("div");
        div.className = "wrong-item";
        div.innerHTML = `<span class="word">${idx + 1}. ${w.word}</span> â€” 
          <span class="correct">ì •ë‹µ: ${w.correct}</span>
          <span class="selected"> Â· ë‚´ ë‹µ: ${w.selected}</span>`;
        wrongList.appendChild(div);
      });
    }

    function endQuiz() {
      quizCard.style.display = "none";
      resultCard.style.display = "block";

      const rate = total > 0 ? (score / total) * 100 : 0;
      let comment = "";
      if (rate >= 80) comment = "ì™„ì „ ìµìˆ™í•œ ì„¸íŠ¸ ê°™ì•„ìš”! ğŸ˜";
      else if (rate >= 50) comment = "ì ˆë°˜ ì´ìƒ ë§ì·„ì–´ìš”. í•œ ë²ˆ ë” ëŒë¦¬ë©´ ì™„ì „ ë‚´ ê²ƒì´ ë  ë“¯! ğŸ’ª";
      else comment = "ì¡°ê¸ˆ ì–´ë ¤ì› ì£ ? í‹€ë¦° ë‹¨ì–´ë“¤ ìœ„ì£¼ë¡œ ë‹¤ì‹œ ì™¸ì›Œë³´ë©´ ì¢‹ì•„ìš” ğŸ“–";

      resultText.textContent = `ì ìˆ˜: ${score} / ${total} (ì •ë‹µë¥  ${rate.toFixed(1)}%) Â· ${comment}`;

      renderWrongList();
    }

    startBtn.addEventListener("click", startQuiz);
    nextBtn.addEventListener("click", nextQuestion);

    copyWrongBtn.addEventListener("click", async () => {
      const text = buildWrongNoteText();
      if (!text) {
        alert("ì˜¤ë‹µì´ ì—†ìŠµë‹ˆë‹¤!");
        return;
      }
      try {
        await navigator.clipboard.writeText(text);
        alert("ì˜¤ë‹µë…¸íŠ¸ë¥¼ í´ë¦½ë³´ë“œì— ë³µì‚¬í–ˆì–´ìš”. ë©”ëª¨ì¥ì´ë‚˜ ë…¸ì…˜ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš” âœï¸");
      } catch (e) {
        alert("í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆì–´ìš”. ë¸Œë¼ìš°ì € ê¶Œí•œ ë¬¸ì œì¼ ìˆ˜ ìˆì–´ìš”.");
      }
    });

    restartBtn.addEventListener("click", () => {
      if (allWords.length === 0) return;
      startQuiz();
    });
  </script>
</body>
</html>
